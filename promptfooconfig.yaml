# =============================================================================
# Promptfoo Evaluation Configuration - VEEDS Proofreader
# =============================================================================
# Run:  npx promptfoo eval
# View: npx promptfoo view
# CI:   npx promptfoo eval --assert (exit code 1 on failure)
# =============================================================================

description: "VEEDS Proofreader Evaluation"

# =============================================================================
# TRACING CONFIGURATION (OpenTelemetry â†’ Jaeger)
# =============================================================================
tracing:
  enabled: true
  forward:
    endpoint: http://localhost:4322  # OTEL Collector OTLP HTTP
  serviceName: promptfoo-service

sharing:
   apiBaseUrl: http://promptfoo:3210
   appBaseUrl: http://promptfoo:3210

# ---------------------------------------------------------------------------
# Prompts: Load from Langfuse
# ---------------------------------------------------------------------------
prompts:
  - "langfuse://veeds-proofreader@production"

# ---------------------------------------------------------------------------
# Providers: Multi-Provider Support (OpenAI, Anthropic, Bedrock)
# ---------------------------------------------------------------------------
providers:
  # --- OpenAI (ChatGPT) ---
  - id: openai:chat:gpt-4o-mini
    label: "GPT-4o Mini"
    config:
      temperature: 0
      max_tokens: 2048

  # Uncomment to add more providers:
  # - id: openai:chat:gpt-4o
  #   label: "GPT-4o"
  #   config:
  #     temperature: 0
  #     max_tokens: 2048
  #     apiKey: env:OPENAI_API_KEY

  # --- Anthropic (Direct API) ---
  # - id: anthropic:messages:claude-3-5-sonnet-20241022
  #   label: "Claude 3.5 Sonnet (API)"
  #   config:
  #     temperature: 0
  #     max_tokens: 2048
  #     apiKey: env:ANTHROPIC_API_KEY

  # - id: anthropic:messages:claude-3-5-haiku-20241022
  #   label: "Claude 3.5 Haiku (API)"
  #   config:
  #     temperature: 0
  #     max_tokens: 2048
  #     apiKey: env:ANTHROPIC_API_KEY

  # --- AWS Bedrock ---
  # - id: bedrock:anthropic.claude-3-5-sonnet-20241022-v2:0
  #   label: "Claude 3.5 Sonnet (Bedrock)"
  #   config:
  #     region: eu-central-1
  #     max_tokens: 2048
  #     temperature: 0
  #     # Uses AWS_PROFILE or AWS_ACCESS_KEY_ID/AWS_SECRET_ACCESS_KEY from .env

  # - id: bedrock:anthropic.claude-3-5-haiku-20241022-v1:0
  #   label: "Claude 3.5 Haiku (Bedrock)"
  #   config:
  #     region: eu-central-1
  #     max_tokens: 2048
  #     temperature: 0

# ---------------------------------------------------------------------------
# Default assertions applied to ALL test cases
# ---------------------------------------------------------------------------
defaultTest:
  assert:
    - type: is-json
    - type: latency
      threshold: 5000
    - type: javascript
      value: |
        const parsed = JSON.parse(output);
        return parsed.hasOwnProperty('isValid') && parsed.hasOwnProperty('errors');

# ---------------------------------------------------------------------------
# Test Cases: Load from generated Golden Dataset tests
# ---------------------------------------------------------------------------
tests: file://eval/generated-tests.yaml

# ---------------------------------------------------------------------------
# NOTE: If generated-tests.yaml doesn't exist yet, uncomment the inline
# fallback below and run: npx tsx eval/generate-promptfoo-tests.ts
# ---------------------------------------------------------------------------
# tests:
#   - description: "Fallback: Invalid materialNumber"
#     vars:
#       yaml_entry: "materialNumber: INVALID\ndescription: Bremsscheibe\nunit: mm"
#     assert:
#       - type: javascript
#         value: "const p = JSON.parse(output); return p.isValid === false;"
#   - description: "Fallback: Valid entry"
#     vars:
#       yaml_entry: "materialNumber: ABC-12345\ndescription: Bremsscheibe vorne links\nunit: mm"
#     assert:
#       - type: javascript
#         value: "const p = JSON.parse(output); return p.isValid === true;"

# ---------------------------------------------------------------------------
# Output configuration
# ---------------------------------------------------------------------------
# Write to promptfoo_data which is mounted to container
outputPath: /home/promptfoo/.promptfoo/output/latest.json

# ---------------------------------------------------------------------------
# Evaluation options
# ---------------------------------------------------------------------------
evaluateOptions:
  maxConcurrency: 5
  repeat: 1
  showProgressBar: true
